!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("activate",[],t):"object"==typeof exports?exports.activate=t():e.activate=t()}("undefined"!=typeof self?self:this,function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){(function(e){var n,r,o;function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(a,c){"object"==i(t)&&"object"==i(e)?e.exports=c():(r=[],void 0===(o="function"==typeof(n=c)?n.apply(t,r):n)||(e.exports=o))}("undefined"!=typeof self&&self,function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1);function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return function(e,t,n){t&&o(e.prototype,t)}(e,[{key:"_start",value:function(e,t,n,r){var o=this;o._factory=r,o._syncher=r.createSyncher(e,t,n),o._manager=r.createSimpleChatManager(e,t,n,o._syncher),o.discovery=o._manager.discovery,o.identityManager=o._manager.identityManager,o._domain=o._manager._domain,o._myUrl=e,o.hypertyURL=e,o._runtimeURL=n.runtimeURL,o._bus=t,o._syncher.onNotification(function(e){console.log("[SimpleChat] onNotification:",e),o.processNotification(e)}),o._resumeReporters(),o._resumeObservers(),console.log("[SimpleChat] configuration ",n),o._manager.offline=!!n.offline&&n.offline,o._manager.backup=!!n.backup&&n.backup}},{key:"register",value:function(e,t){var n=this;n._manager.identityManager.discoverUserRegistered().then(function(r){var o={userProfile:{guid:r.guid,userURL:r.userURL,info:{code:t}}},i={type:"forward",to:e,from:n.hypertyURL,identity:o,body:{type:"create",from:n.hypertyURL,identity:o}};n._bus.postMessage(i)}).catch(function(e){console.error("[SimpleChat] ERROR:",e),reject(e)})}},{key:"newParticipant",value:function(e,t,n){var r=this;r._manager.identityManager.discoverUserRegistered().then(function(o){console.log("[SimpleChat] GET MY IDENTITY:",o);var i={type:"forward",to:"".concat(e,"/tickets"),from:n,identity:o,body:{type:"update",from:n,identity:o,status:"new-participant",participant:t}};r._bus.postMessage(i)}).catch(function(e){console.error("[SimpleChat] ERROR:",e),reject(e)})}},{key:"closeTicket",value:function(e,t,n){var r=this;r._manager.identityManager.discoverUserRegistered().then(function(o){var i={type:"forward",to:"".concat(e,"/tickets"),from:n,identity:o,body:{type:"update",from:n,identity:o,status:"closed",participant:t}};r._bus.postMessage(i)}).catch(function(e){console.error("[SimpleChat] ERROR:",e),reject(e)})}},{key:"_getRegisteredUser",value:function(){var e=this;return new Promise(function(t,n){e._manager.currentIdentity?t(e._manager.currentIdentity):e._manager.identityManager.discoverUserRegistered().then(function(e){console.log("[SimpleChat] GET MY IDENTITY:",e),t(e)}).catch(function(e){console.error("[SimpleChat] ERROR:",e),n(e)})})}},{key:"_resumeReporters",value:function(){var e=this,t=this;t._syncher.resumeReporters({store:!0}).then(function(n){var r=Object.keys(n);r.length>0&&t._getRegisteredUser().then(function(o){r.forEach(function(r){console.log("[SimpleChat.resumeReporter]: ",r);var i=t._factory.createChat(t._syncher,t._domain,o,t._manager);i.dataObjectReporter=n[r],e._manager._reportersControllers[r]=i,t._resumeInterworking(i.dataObjectReporter),console.log("[SimpleChat] chatController invitationsHandler: ",i.invitationsHandler)}),t._onResumeReporter&&t._onResumeReporter(e._manager._reportersControllers)})}).catch(function(e){console.info("[SimpleChat.resumeReporters] :",e)})}},{key:"_resumeObservers",value:function(){var e=this,t=this;t._syncher.resumeObservers({store:!0}).then(function(n){console.log("[SimpleChat] resuming observers : ",n,t,t._onResume);var r=Object.keys(n);r.length>0&&t._getRegisteredUser().then(function(o){r.forEach(function(r){console.log("[SimpleChat].syncher.resumeObserver: ",r);var i=n[r],a=t._factory.createChat(t._syncher,t._domain,o,t._manager);a.dataObjectObserver=i,e._manager._observersControllers[r]=a}),t._onResumeObserver&&t._onResumeObserver(e._manager._observersControllers)})}).catch(function(e){console.info("[SimpleChat] Resume Observer | ",e)})}},{key:"_resumeInterworking",value:function(e){var t=this;if(e.data.participants){var n=e.data.participants,r=e.url,o=e.schema;console.log("[SimpleChat._resumeInterworking for] ",n),Object.keys(n).forEach(function(i){var a=n[i].identity.userProfile.userURL.split("://");if("user"!==a[0]){console.log("[SimpleChat._resumeInterworking for] ",i),a=a[0]+"://"+a[1].split("/")[1];var c={type:"create",from:t._myUrl,to:a,body:{resource:r,schema:o,value:e.metadata}};t._bus.postMessage(c,function(){})}})}}},{key:"create",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{mutual:!1,domain_registration:!1,reuseURL:!0};return this._manager.create(e,t,n)}},{key:"onInvitation",value:function(e){return this._manager.onInvitation(e)}},{key:"onResumeReporter",value:function(e){this._onResumeReporter=e}},{key:"onResumeObserver",value:function(e){this._onResumeObserver=e}},{key:"join",value:function(e){return this._manager.join(e,!1)}},{key:"myIdentity",value:function(e){return console.log("[SimpleChat.myIdentity] ",e),this._manager.myIdentity(e)}},{key:"processNotification",value:function(e){return this._manager.processNotification(e)}},{key:"onInvitation",value:function(e){return this._manager.onInvitation(e)}},{key:"name",get:function(){return r.a.name}},{key:"descriptor",get:function(){return r.a}},{key:"runtimeHypertyURL",get:function(){return this._myUrl}}]),e}();t.default=i},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r={name:"SimpleChat",language:"javascript",signature:"",configuration:{backup:!0,heartBeat:60,offline:"hyperty://sharing-cities-dsm/offline-sub-mgr"},hypertyType:["chat"],constraints:{browser:!0},dataObjects:["https://catalogue.%domain%/.well-known/dataschema/Communication"]}}]).default})}).call(t,n(1)(e))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}}]).default});