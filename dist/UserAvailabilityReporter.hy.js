!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("activate",[],e):"object"==typeof exports?exports.activate=e():t.activate=e()}("undefined"!=typeof self?self:this,function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:r})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e,n,r){return{name:"UserAvailabilityReporter",instance:new o(t,e,n,r)}};var r=n(1);function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var o=function(){function t(e,n,r,i){var o=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._context=i.createContextReporter(e,n,r);console.info("[UserAvailabilityReporter] started with url: ",e),this.identityManager=i.createIdentityManager(e,r.runtimeURL,n),this.context.syncher.onNotification(function(t){o.context.processNotification(t)})}return function(t,e,n){e&&i(t.prototype,e),n&&i(t,n)}(t,[{key:"start",value:function(){var t=this;return new Promise(function(e,n){console.log("[UserAvailabilityReporter.starting]"),t.context.syncher.resumeReporters({store:!0}).then(function(n){if(Object.keys(n).length>0)t.context.contexts.myAvailability=t._filterResumedContexts(n),console.log("[UserAvailabilityReporter.start] resuming ",t.context.contexts.myAvailability),t.context._onSubscription(t.context.contexts.myAvailability),e(t.context.contexts.myAvailability);else{console.log("[UserAvailabilityReporter.start] nothing to resume ",n);var i="myAvailability";e(t.create(i,Object(r.a)(),["availability_context"],i))}}).catch(function(t){console.error("[UserAvailabilityReporter] Resume failed | ",t)})}).catch(function(t){reject("[UserAvailabilityReporter] Start failed | ",t)})}},{key:"_filterResumedContexts",value:function(t){var e=this;return Object.keys(t).filter(function(n){return t[n].metadata.reporter===e.context.syncher._owner}).reduce(function(e,n){return Date.parse(t[n].metadata.lastModified)>0&&(e=t[n]),e},{})}},{key:"onResumeReporter",value:function(t){this.context._onResumeReporter=t}},{key:"create",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"myContext";return this.context.create(t,e,n,r)}},{key:"setStatus",value:function(t){var e=[{value:t}];return this._context.setContext("myAvailability",e)}},{key:"context",get:function(){return this._context}}]),t}()},function(t,e,n){"use strict";e.a=function(){return Object.assign({},{id:"_"+Math.random().toString(36).substr(2,9),values:[{name:"availability",type:"availability_status",unit:"pres",value:"available"}]})}}]).default});